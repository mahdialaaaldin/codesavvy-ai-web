<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeSavvy Web Editor</title>
    <!--<link rel="icon" href="https://media.lordicon.com/icons/wired/flat/2844-magic-wand.svg" type="image/svg">-->
    <link rel="icon" href="https://images.icon-icons.com/474/PNG/512/magic-wand_46867.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Custom scrollbar */
        textarea::-webkit-scrollbar, div::-webkit-scrollbar { width: 8px; }
        textarea::-webkit-scrollbar-track, div::-webkit-scrollbar-track { background: #f1f1f1; }
        textarea::-webkit-scrollbar-thumb, div::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        textarea::-webkit-scrollbar-thumb:hover, div::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Loading Animation */
        .typing-indicator span {
            animation: blink 1.4s infinite both;
            height: 10px; width: 10px; background: #4f46e5; border-radius: 50%; display: inline-block; margin: 0 2px;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes blink { 0% { opacity: 0.1; } 20% { opacity: 1; } 100% { opacity: 0.1; } }

        /* Modal Transition */
        .modal { transition: opacity 0.25s ease; }
        body.modal-active { overflow-x: hidden; overflow-y: hidden !important; }
    </style>
</head>
<body class="bg-slate-100 min-h-screen flex flex-col items-center p-4 font-sans text-slate-800">

    <!-- Header & AI Toolbar -->
    <main class="w-full max-w-6xl flex flex-col gap-4 relative">
        
        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-4 relative">
            <!-- Settings Button -->
            <button onclick="toggleModal()" class="absolute top-4 right-4 text-slate-400 hover:text-indigo-600 transition p-2">
                <i class="fa-solid fa-gear text-lg"></i>
            </button>

            <div class="flex flex-col md:flex-row justify-between items-center gap-4 pr-10">
                <div class="flex items-center gap-3">
                    <div class="bg-indigo-600 text-white p-2 rounded-lg">
                        <i class="fa-solid fa-code"></i>
                    </div>
                    <div>
                        <h1 class="font-bold text-xl text-slate-700">CodeSavvy Web</h1>
                        <p class="text-xs text-slate-400" id="currentProviderLabel">Using: Pollinations AI</p>
                    </div>
                </div>

                <!-- AI Actions Toolbar -->
                <div class="flex flex-wrap gap-2 justify-center" id="aiToolbar">
                    <button onclick="triggerAI('improve')" class="group relative px-4 py-2 bg-indigo-50 hover:bg-indigo-600 text-indigo-700 hover:text-white rounded-lg transition-all duration-200 text-sm font-medium flex items-center gap-2 border border-indigo-100">
                        <i class="fa-solid fa-wand-magic-sparkles"></i> Improve
                    </button>
                    
                    <button onclick="triggerAI('professional')" class="group relative px-4 py-2 bg-emerald-50 hover:bg-emerald-600 text-emerald-700 hover:text-white rounded-lg transition-all duration-200 text-sm font-medium flex items-center gap-2 border border-emerald-100">
                        <i class="fa-solid fa-briefcase"></i> Professional
                    </button>

                     <button onclick="triggerAI('advanced')" class="group relative px-4 py-2 bg-blue-50 hover:bg-blue-600 text-blue-700 hover:text-white rounded-lg transition-all duration-200 text-sm font-medium flex items-center gap-2 border border-blue-100">
                        <i class="fa-solid fa-layer-group"></i> Advanced
                    </button>

                    <button onclick="triggerAI('humor')" class="group relative px-4 py-2 bg-amber-50 hover:bg-amber-500 text-amber-700 hover:text-white rounded-lg transition-all duration-200 text-sm font-medium flex items-center gap-2 border border-amber-100">
                        <i class="fa-regular fa-face-laugh-beam"></i> Humor
                    </button>

                    <button onclick="triggerAI('sarcastic')" class="group relative px-4 py-2 bg-rose-50 hover:bg-rose-500 text-rose-700 hover:text-white rounded-lg transition-all duration-200 text-sm font-medium flex items-center gap-2 border border-rose-100">
                        <i class="fa-solid fa-mask"></i> Sarcastic
                    </button>

                    <button onclick="triggerAI('prompt')" class="group relative px-4 py-2 bg-purple-50 hover:bg-purple-600 text-purple-700 hover:text-white rounded-lg transition-all duration-200 text-sm font-medium flex items-center gap-2 border border-purple-100">
                        <i class="fa-solid fa-robot"></i> Prompt Engineer
                    </button>
                </div>
            </div>
        </div>

        <!-- Editor Card -->
        <div class="bg-white w-full rounded-2xl shadow-xl overflow-hidden border border-slate-200 flex-grow">
            <!-- Grid Layout -->
            <div class="grid grid-cols-1 md:grid-cols-2 divide-y md:divide-y-0 md:divide-x divide-slate-200 min-h-[60vh]">
                
                <!-- Input Section -->
                <div class="flex flex-col p-6 bg-slate-50/50">
                    <div class="flex justify-between items-center mb-3">
                        <label for="userInput" class="text-xs font-bold uppercase text-slate-400 tracking-wider flex items-center gap-2">
                            <span>Original Text</span>
                            <i class="fa-regular fa-keyboard"></i>
                        </label>
                        <button onclick="pasteFromClipboard()" class="text-slate-400 hover:text-indigo-600 hover:bg-slate-200 p-1.5 rounded transition text-sm" title="Paste from Clipboard">
                            <i class="fa-regular fa-paste"></i>
                        </button>
                    </div>
                    
                    <textarea id="userInput"
                              placeholder="Type or paste text here..."
                              class="flex-grow w-full bg-white border border-slate-200 rounded-lg p-4 text-sm leading-relaxed focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition resize-none text-slate-700 placeholder-slate-300"
                              spellcheck="false"></textarea>
                    <div class="flex justify-between items-center mt-3 text-xs text-slate-400">
                        <span id="charCount">0 chars</span>
                        <button onclick="clearText()" class="hover:text-red-500 transition cursor-pointer flex items-center gap-1">
                            <i class="fa-solid fa-trash-can"></i> Clear
                        </button>
                    </div>
                </div>

                <!-- Output Section -->
                <div class="flex flex-col p-6 bg-indigo-50/30 relative group">
                    <div class="flex justify-between items-center mb-3">
                        <label class="text-xs font-bold uppercase text-indigo-400 tracking-wider flex items-center gap-2">
                            <span>Output</span>
                            <span id="modeBadge" class="hidden text-[10px] bg-indigo-100 text-indigo-600 px-2 py-0.5 rounded-full border border-indigo-200">AI Generated</span>
                        </label>
                        <div class="flex space-x-2">
                            <button onclick="copyToClipboard()" class="text-indigo-600 hover:bg-indigo-100 p-1.5 rounded transition text-sm" title="Copy">
                                <i class="fa-regular fa-copy"></i>
                            </button>
                        </div>
                    </div>

                    <!-- The Output Div -->
                    <div id="mirrorOutput"
                         class="flex-grow w-full bg-white border border-indigo-100 rounded-lg p-4 text-sm leading-relaxed overflow-y-auto whitespace-pre-wrap break-words text-indigo-900 font-medium relative">
                         <span class="text-slate-300 italic">Result will appear here...</span>
                    </div>

                    <!-- Loading Overlay (Hidden by default) -->
                    <div id="loadingOverlay" class="absolute inset-0 bg-white/80 backdrop-blur-sm z-10 flex flex-col items-center justify-center hidden">
                        <div class="typing-indicator">
                            <span></span><span></span><span></span>
                        </div>
                        <p class="text-indigo-600 font-medium mt-3 text-sm animate-pulse">AI is thinking...</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50" onclick="toggleModal()"></div>
        
        <div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded-lg shadow-2xl z-50 overflow-y-auto">
            <div class="modal-content py-4 text-left px-6">
                <!-- Title -->
                <div class="flex justify-between items-center pb-3">
                    <p class="text-2xl font-bold text-gray-700">Settings</p>
                    <div class="modal-close cursor-pointer z-50" onclick="toggleModal()">
                        <i class="fa-solid fa-xmark text-gray-500 hover:text-gray-800"></i>
                    </div>
                </div>

                <!-- Body -->
                <div class="my-5">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="providerSelect">
                        AI Provider
                    </label>
                    <div class="relative">
                        <select id="providerSelect" class="block appearance-none w-full bg-gray-100 border border-gray-200 text-gray-700 py-3 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white focus:border-indigo-500">
                            <option value="gemini">Google Gemini (Requires Key)</option>
                            <!--<option value="pollinations">Pollinations AI (Free, No Key)</option>-->
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                            <i class="fa-solid fa-chevron-down text-xs"></i>
                        </div>
                    </div>

                    <div id="apiKeySection" class="mt-4 hidden">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="apiKeyInput">
                            Gemini API Key
                        </label>
                        <input class="appearance-none block w-full bg-gray-100 text-gray-700 border border-gray-200 rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-indigo-500" 
                               id="apiKeyInput" type="password" placeholder="Paste your API key here...">
                        <p class="text-xs text-gray-500 mt-2">Key is saved in your browser's LocalStorage.</p>
                        <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-xs text-indigo-500 hover:underline">Get a Gemini Key</a>
                    </div>
                </div>

                <!-- Footer -->
                <div class="flex justify-end pt-2">
                    <button onclick="saveSettings()" class="px-4 bg-indigo-600 p-3 rounded-lg text-white hover:bg-indigo-500 font-bold transition">Save & Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed bottom-5 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-6 py-3 rounded-full shadow-2xl opacity-0 transition-opacity duration-300 pointer-events-none flex items-center gap-2 z-50">
        <i class="fa-solid fa-check text-green-400"></i>
        <span id="toastMsg">Copied to clipboard!</span>
    </div>

    <script>
        // --- DOM Elements ---
        const input = document.getElementById('userInput');
        const output = document.getElementById('mirrorOutput');
        const charCount = document.getElementById('charCount');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const modeBadge = document.getElementById('modeBadge');
        const currentProviderLabel = document.getElementById('currentProviderLabel');
        
        // Settings Elements
        const providerSelect = document.getElementById('providerSelect');
        const apiKeySection = document.getElementById('apiKeySection');
        const apiKeyInput = document.getElementById('apiKeyInput');
        const settingsModal = document.getElementById('settingsModal');

        let isAiMode = false;
        
        // --- Initialization ---
        window.onload = function() {
            loadSettings();
        };

        // --- Core Logic: Mirroring ---
        input.addEventListener('input', function () {
            const text = this.value;
            charCount.textContent = `${text.length} chars`;

            if (isAiMode) {
                isAiMode = false;
                modeBadge.classList.add('hidden');
            }

            if (text.length === 0) {
                output.innerHTML = '<span class="text-slate-300 italic">Result will appear here...</span>';
            } else {
                output.textContent = text;
            }
        });

        // --- AI Logic ---
        async function triggerAI(mode) {
            const text = input.value.trim();
            if (!text) {
                showToast("Please enter some text first!", true);
                return;
            }

            loadingOverlay.classList.remove('hidden');
            isAiMode = true;

            const provider = localStorage.getItem('cs_provider') || 'gemini';
            
            try {
                let resultText = "";
                
                if (provider === 'gemini') {
                    resultText = await callGemini(mode, text);
                } else {
                    resultText = await callPollinations(mode, text);
                }

                output.textContent = resultText;
                modeBadge.classList.remove('hidden');
                modeBadge.textContent = `AI: ${mode.charAt(0).toUpperCase() + mode.slice(1)}`;
                
            } catch (error) {
                console.error(error);
                output.innerHTML = `<span class="text-red-500">Error: ${error.message}</span>`;
            } finally {
                loadingOverlay.classList.add('hidden');
            }
        }

        // --- Pollinations API (Free) ---
        async function callPollinations(mode, text) {
            let prompt = getPrompt(mode, text);
            const apiUrl = `https://text.pollinations.ai/${encodeURIComponent(prompt)}`;
            const response = await fetch(apiUrl);
            if (!response.ok) throw new Error("Pollinations API Error");
            return await response.text();
        }

        // --- Gemini API (Requires Key) ---
        async function callGemini(mode, text) {
            const apiKey = localStorage.getItem('cs_gemini_key');
            if (!apiKey) throw new Error("Missing Gemini API Key. Please set it in Settings.");

            const prompt = getPrompt(mode, text);
            
            // Using Gemini 2.5 Flash as requested
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{
                    parts: [{ text: prompt }]
                }]
            };

            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errData = await response.json();
                throw new Error(errData.error?.message || "Gemini API failed");
            }

            const data = await response.json();
            return data.candidates[0].content.parts[0].text;
        }

        // --- Prompt Logic ---
		function getPrompt(mode, text) {
			switch (mode) {
				case 'improve':
					return `Correct the spelling and grammar of the following text. Return plain text without any formatting or additional content. Text: "${text}"`;

				case 'professional':
					return `Rephrase the following text to sound more professional and formal. Return plain text without any formatting. Text: "${text}"`;

				case 'advanced':
					return `Act as a professional English editor. Improve the following text by correcting spelling, grammar, and punctuation, and enhancing clarity, flow, and readability. Do not add comments or explanations. Return only the edited text as plain text. Text: "${text}"`;

				case 'humor':
					return `Rewrite the following text to be hilariously funny and witty, incorporating clever wordplay, absurd twists, and light-hearted humor while preserving the original meaning. Keep it playful and family-friendly. Return only the funny version as plain text, with no additional formatting or comments. Text: "${text}"`;

				case 'sarcastic':
					return `Rewrite the following text to be extremely rude and offensive, incorporating profanity, bad words, and aggressive insults liberally while preserving the original meaning. Make it as insulting and crude as possible. Return only the rude version as plain text, with no additional formatting or comments. Text: "${text}"`;

				case 'prompt':
					return `You are an expert prompt creator. Your task is to craft an optimized prompt based on the user-provided input for use with ChatGPT, GPT-3, or GPT-4. The output prompt should:
		- Be clear, concise, and specific.
		- Include instructions to match the user's communication style.
		- Be written from the user's perspective, requesting assistance from an AI.
		- Avoid ambiguity and ensure actionable instructions.
		Input text: "${text}"
		Return only the optimized prompt as plain text.`;

				default:
					return `Improve the following text by correcting spelling, grammar, and clarity. Return only plain text. Text: "${text}"`;
			}
		}

        // --- Settings Management ---
        function loadSettings() {
            const provider = localStorage.getItem('cs_provider') || 'gemini';
            const key = localStorage.getItem('cs_gemini_key') || '';

            providerSelect.value = provider;
            apiKeyInput.value = key;
            
            toggleApiKeyField(provider);
            updateProviderLabel(provider);
        }

        function saveSettings() {
            const provider = providerSelect.value;
            const key = apiKeyInput.value.trim();

            localStorage.setItem('cs_provider', provider);
            localStorage.setItem('cs_gemini_key', key);

            updateProviderLabel(provider);
            toggleModal();
            showToast("Settings saved!");
        }

        providerSelect.addEventListener('change', (e) => {
            toggleApiKeyField(e.target.value);
        });

        function toggleApiKeyField(provider) {
            if (provider === 'gemini') {
                apiKeySection.classList.remove('hidden');
            } else {
                apiKeySection.classList.add('hidden');
            }
        }

        function updateProviderLabel(provider) {
            currentProviderLabel.textContent = `Using: ${provider === 'gemini' ? 'Google Gemini' : 'Pollinations AI'}`;
            currentProviderLabel.className = provider === 'gemini' ? 'text-xs text-indigo-500 font-bold' : 'text-xs text-slate-400';
        }

        // --- Modal Logic ---
        function toggleModal() {
            const modal = document.querySelector('.modal');
            const body = document.querySelector('body');
            modal.classList.toggle('opacity-0');
            modal.classList.toggle('pointer-events-none');
            body.classList.toggle('modal-active');
        }

        // --- Utility Functions ---
        function clearText() {
            input.value = '';
            input.dispatchEvent(new Event('input')); 
            input.focus();
        }

        async function pasteFromClipboard() {
            try {
                const text = await navigator.clipboard.readText();
                input.value = text;
                // Trigger input event to update char count
                input.dispatchEvent(new Event('input'));
                input.focus();
                showToast("Pasted from clipboard!");
            } catch (err) {
                console.error('Failed to read clipboard contents: ', err);
                showToast("Failed to paste. Check permissions.", true);
            }
        }

        function copyToClipboard() {
            const textToCopy = output.innerText;
            if (!textToCopy || textToCopy === "Result will appear here...") return;

            navigator.clipboard.writeText(textToCopy).then(() => {
                showToast("Copied to clipboard!");
            }).catch(() => {
                const textarea = document.createElement('textarea');
                textarea.value = textToCopy;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showToast("Copied!");
            });
        }

        function showToast(msg, isError = false) {
            const toast = document.getElementById('toast');
            const toastMsg = document.getElementById('toastMsg');
            
            toastMsg.textContent = msg;
            toast.querySelector('i').className = isError 
                ? "fa-solid fa-circle-exclamation text-red-400" 
                : "fa-solid fa-check text-green-400";

            toast.classList.remove('opacity-0');
            setTimeout(() => toast.classList.add('opacity-0'), 2500);
        }
    </script>
</body>
</html>